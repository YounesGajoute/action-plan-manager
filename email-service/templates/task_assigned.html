<!-- ===================================================================
     email-service/templates/task_assigned.html - Task Assignment Template
     =================================================================== -->

{% extends "base.html" %}

{% block title %}Nouvelle tÃ¢che assignÃ©e - {{ system_name }}{% endblock %}

{% block header %}
<h1>ğŸ¯ Nouvelle TÃ¢che AssignÃ©e</h1>
<p>{{ company_name }} - {{ system_name }}</p>
{% endblock %}

{% block content %}
<h2>Bonjour {{ user_name }},</h2>

<p>Une nouvelle tÃ¢che vous a Ã©tÃ© assignÃ©e dans le systÃ¨me de gestion des plans d'action TechMac.</p>

<!-- Welcome Message for New Tasks -->
<div style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); 
            padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
    <div style="font-size: 48px; margin-bottom: 10px;">ğŸš€</div>
    <h3 style="margin: 0; color: #1976d2;">Nouvelle Mission</h3>
    <p style="margin: 5px 0 0 0; color: #666;">Votre expertise est requise</p>
</div>

<!-- Task Details -->
<div class="task-details {% if task.priority %}priority-{{ task.priority.lower() }}{% endif %}">
    <h3>ğŸ“‹ DÃ©tails de la tÃ¢che</h3>
    
    <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px 15px; align-items: start;">
        <strong>Description :</strong>
        <span>{{ task.action_description }}</span>
        
        <strong>Client :</strong>
        <span style="color: #1976d2; font-weight: 600;">{{ task.customer }}</span>
        
        <strong>Demandeur :</strong>
        <span>{{ task.requester }}</span>
        
        {% if task.po_number %}
        <strong>NÂ° PO :</strong>
        <span style="font-family: monospace; background: #f8f9fa; padding: 2px 6px; border-radius: 3px;">{{ task.po_number }}</span>
        {% endif %}
        
        {% if task.category %}
        <strong>CatÃ©gorie :</strong>
        <span style="background: 
            {% if task.category.lower() == 'installation' %}#e8f5e8
            {% elif task.category.lower() == 'rÃ©paration' %}#fff3cd
            {% elif task.category.lower() == 'dÃ©veloppement' %}#d1ecf1
            {% elif task.category.lower() == 'livraison' %}#f8d7da
            {% elif task.category.lower() == 'commercial' %}#e2e3e5
            {% else %}#f8f9fa{% endif %}; 
            padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
            {{ task.category }}
        </span>
        {% endif %}
        
        {% if task.priority %}
        <strong>PrioritÃ© :</strong>
        <span style="color: 
            {% if task.priority.lower() == 'high' %}#dc3545
            {% elif task.priority.lower() == 'medium' %}#ffc107
            {% else %}#28a745{% endif %}; font-weight: 600;">
            {{ task.priority }}
            {% if task.priority.lower() == 'high' %}ğŸ”´
            {% elif task.priority.lower() == 'medium' %}ğŸŸ¡
            {% else %}ğŸŸ¢{% endif %}
        </span>
        {% endif %}
        
        {% if task.deadline %}
        <strong>Ã‰chÃ©ance :</strong>
        <span style="font-weight: 600; color: 
            {% set deadline_days = (task.deadline_date - today_date).days if task.deadline_date and today_date else 999 %}
            {% if deadline_days <= 0 %}#dc3545
            {% elif deadline_days <= 3 %}#ffc107
            {% else %}#28a745{% endif %};">
            {{ task.deadline }}
            {% if deadline_days <= 0 %}âš ï¸
            {% elif deadline_days <= 7 %}ğŸ“…
            {% else %}âœ…{% endif %}
        </span>
        {% endif %}
        
        {% if task.status %}
        <strong>Statut :</strong>
        <span class="status-{{ task.status.lower().replace(' ', '-') }}">{{ task.status }}</span>
        {% endif %}
    </div>
    
    {% if task.notes %}
    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
        <strong>Notes :</strong>
        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 5px; font-style: italic;">
            {{ task.notes }}
        </div>
    </div>
    {% endif %}
</div>

<!-- Assignment Context -->
{% if assigned_by %}
<div style="background: #e9ecef; padding: 15px; border-radius: 8px; margin: 20px 0;">
    <p style="margin: 0; font-size: 14px;">
        <strong>AssignÃ© par :</strong> {{ assigned_by }}<br>
        <strong>Date d'assignation :</strong> {{ assignment_date or 'Aujourd\'hui' }}
    </p>
</div>
{% endif %}

<!-- Quick Actions -->
<div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
    <h4 style="margin: 0 0 15px 0; color: #1976d2;">ğŸ”§ Actions Rapides</h4>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
        <a href="{{ base_url }}/tasks/{{ task.id }}" class="email-button" style="margin: 0; text-align: center; display: block;">
            ğŸ“„ Voir DÃ©tails
        </a>
        <a href="{{ base_url }}/tasks/{{ task.id }}/accept" class="email-button" style="margin: 0; background: #28a745; text-align: center; display: block;">
            âœ… Accepter
        </a>
        <a href="{{ base_url }}/tasks/{{ task.id }}/update" class="email-button" style="margin: 0; background: #17a2b8; text-align: center; display: block;">
            ğŸ“ Mettre Ã  Jour
        </a>
    </div>
</div>

<!-- Category-Specific Guidelines -->
{% if task.category %}
<div style="border-left: 4px solid #17a2b8; background: #d1ecf1; padding: 15px; margin: 20px 0;">
    <h4 style="margin: 0 0 10px 0; color: #0c5460;">
        {% if task.category.lower() == 'installation' %}ğŸ”§ Guidelines Installation
        {% elif task.category.lower() == 'rÃ©paration' %}ğŸ› ï¸ Guidelines RÃ©paration
        {% elif task.category.lower() == 'dÃ©veloppement' %}ğŸ’» Guidelines DÃ©veloppement
        {% elif task.category.lower() == 'livraison' %}ğŸ“¦ Guidelines Livraison
        {% elif task.category.lower() == 'commercial' %}ğŸ’¼ Guidelines Commercial
        {% else %}ğŸ“‹ Guidelines GÃ©nÃ©rales{% endif %}
    </h4>
    <ul style="margin: 0; padding-left: 20px; color: #0c5460;">
        {% if task.category.lower() == 'installation' %}
            <li>VÃ©rifier la disponibilitÃ© des Ã©quipements</li>
            <li>Confirmer l'accÃ¨s au site avec le client</li>
            <li>PrÃ©parer la documentation technique</li>
        {% elif task.category.lower() == 'rÃ©paration' %}
            <li>Diagnostiquer le problÃ¨me en prioritÃ©</li>
            <li>VÃ©rifier la disponibilitÃ© des piÃ¨ces</li>
            <li>Estimer le temps de rÃ©paration</li>
        {% elif task.category.lower() == 'dÃ©veloppement' %}
            <li>Analyser les spÃ©cifications techniques</li>
            <li>DÃ©finir l'architecture solution</li>
            <li>Planifier les phases de dÃ©veloppement</li>
        {% elif task.category.lower() == 'livraison' %}
            <li>VÃ©rifier la prÃ©paration des articles</li>
            <li>Coordonner avec la logistique</li>
            <li>Confirmer les dÃ©lais avec le client</li>
        {% elif task.category.lower() == 'commercial' %}
            <li>PrÃ©parer la documentation commerciale</li>
            <li>Analyser les besoins du client</li>
            <li>DÃ©finir la stratÃ©gie de proposition</li>
        {% else %}
            <li>Lire attentivement la description</li>
            <li>Identifier les ressources nÃ©cessaires</li>
            <li>Communiquer les dÃ©pendances</li>
        {% endif %}
    </ul>
</div>
{% endif %}

<!-- Contact Information -->
<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center;">
    <p style="margin: 0; font-size: 14px; color: #666;">
        <strong>Questions ou problÃ¨mes ?</strong><br>
        Contactez votre manager ou l'Ã©quipe support : <a href="mailto:{{ support_email }}">{{ support_email }}</a><br>
        Ou consultez le <a href="{{ base_url }}/help">centre d'aide</a>
    </p>
</div>

<!-- Motivation Message -->
<div style="text-align: center; margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px;">
    <p style="margin: 0; font-size: 16px; color: #495057; font-style: italic;">
        "L'excellence n'est jamais un accident. Elle est toujours le rÃ©sultat d'intentions Ã©levÃ©es, d'efforts sincÃ¨res et d'exÃ©cution intelligente."
    </p>
    <p style="margin: 5px 0 0 0; font-size: 14px; color: #6c757d;">
        Bonne chance avec votre nouvelle mission ! ğŸ’ª
    </p>
</div>

{% endblock %}